<template name="getAccessToken" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="code" description="Full-text search query string."/>
    <sequence>
        <property name="uri.var.code" expression="$func:code"/>
        <property name="uri.var.client_id" expression="$func:client_id"/>
        <property name="uri.var.client_secret" expression="$func:client_secret"/>
        <property name="uri.var.redirect_uri" expression="$func:redirect_uri"/>
        <header name="Content-Type" value="application/x-www-form-urlencoded" scope="transport"/>
        <payloadFactory media-type="text">
            <format>code=$1&amp;client_id=$2&amp;client_secret=$3&amp;grant_type=authorization_code&amp;redirect_uri=$4
            </format>
            <args>
                <arg evaluator="xml" expression="get-property('code')" literal="false"/>
                <arg evaluator="xml"
                     expression="get-property('client_id')"
                     literal="false"/>
                <arg evaluator="xml"
                     expression="get-property('client_secret')"
                     literal="false"/>
                <arg evaluator="xml"
                     expression="get-property('redirect_uri')"
                     literal="false"/>
            </args>
        </payloadFactory>
        <header name="Content-Type"
                scope="default"
                value="application/x-www-form-urlencoded"/>
        <call>
            <endpoint>
                <http method="post" uri-template="https://api.medium.com/v1/tokens" />
            </endpoint>
            <property name="messageType" value="application/json" scope="axis2"/>
        </call>
    </sequence>
</template>